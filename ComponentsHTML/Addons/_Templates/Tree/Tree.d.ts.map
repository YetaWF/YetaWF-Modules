{"version":3,"sources":["AddOns/YetaWF/ComponentsHTML/_Templates/Tree/Tree.ts"],"names":[],"mappings":"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","file":"Tree.d.ts","sourcesContent":["/* Copyright ï¿½ 2019 Softel vdm, Inc. - https://yetawf.com/Documentation/YetaWF/ComponentsHTML#License */\r\n\r\n// Kendo UI menu use\r\n\r\nnamespace YetaWF_ComponentsHTML {\r\n\r\n    //export interface IPackageLocs {\r\n    //    GridTotals: string;\r\n    //    GridTotal0: string;\r\n    //    GridTotalNone: string;\r\n    //}\r\n\r\n    interface TreeSetup {\r\n\r\n        StaticData: any[] | null;\r\n\r\n        DragDrop: boolean;\r\n\r\n        HoverCss: string;\r\n        HighlightCss: string;\r\n        DisabledCss: string;\r\n        RowHighlightCss: string;\r\n        RowDragDropHighlightCss: string;\r\n    }\r\n\r\n    enum TargetPositionEnum {\r\n        on = 0,\r\n        before = 1,\r\n        after = 2,\r\n    }\r\n    export class TreeComponent extends YetaWF.ComponentBaseDataImpl {\r\n\r\n        public static readonly SELECTOR: string = \".yt_tree\";\r\n\r\n        private Setup: TreeSetup;\r\n        private DeletedRecords: number[] = [];// array of deleted record numbers\r\n\r\n        private static DDTree: TreeComponent | null = null;\r\n        private DDSource: HTMLLIElement | null = null;\r\n        private DDSourceAnchor: HTMLAnchorElement | null = null;\r\n        private DDLastTarget: HTMLLIElement | null = null;\r\n        private DDLastTargetAnchor: HTMLAnchorElement | null = null;\r\n        private DDTargetPosition: TargetPositionEnum = TargetPositionEnum.on;\r\n\r\n        constructor(controlId: string, setup: TreeSetup) {\r\n            super(controlId);\r\n            this.Setup = setup;\r\n\r\n            $YetaWF.registerEventHandler(this.Control, \"click\", \"a.t_entry\", (ev: MouseEvent): boolean => {\r\n                var liElem = $YetaWF.elementClosest(ev.__YetaWFElem, \"li\") as HTMLLIElement; // get row we're on\r\n                this.setSelect(liElem);\r\n                this.sendClickEvent();\r\n                return false;\r\n            });\r\n            $YetaWF.registerEventHandler(this.Control, \"click\", \"i.t_icdown\", (ev: MouseEvent): boolean => {\r\n                var li = $YetaWF.elementClosest(ev.__YetaWFElem, \"li\") as HTMLLIElement; // get row we're on\r\n                setTimeout((): void => {\r\n                    this.collapse(li);\r\n                }, 1);\r\n                return false;\r\n            });\r\n            $YetaWF.registerEventHandler(this.Control, \"click\", \"i.t_icright\", (ev: MouseEvent): boolean => {\r\n                var li = $YetaWF.elementClosest(ev.__YetaWFElem, \"li\") as HTMLLIElement; // get row we're on\r\n                setTimeout((): void => {\r\n                    this.expand(li);\r\n                }, 1);\r\n                return false;\r\n            });\r\n            $YetaWF.registerEventHandler(this.Control, \"keydown\", null, (ev: KeyboardEvent): boolean => {\r\n                var key = ev.key;\r\n                if (key === \"ArrowDown\" || key === \"Down\") {\r\n                    var liElem = this.getSelect();\r\n                    if (!liElem) return false;\r\n                    liElem = this.getNextVisibleEntry(liElem);\r\n                    if (!liElem) return false;\r\n                    this.setSelect(liElem, true);\r\n                    this.sendSelectEvent();\r\n                    return false;\r\n                } else if (key === \"ArrowUp\" || key === \"Up\") {\r\n                    var liElem = this.getSelect();\r\n                    if (!liElem) return false;\r\n                    liElem = this.getPrevVisibleEntry(liElem);\r\n                    if (!liElem) return false;\r\n                    this.setSelect(liElem, true);\r\n                    this.sendSelectEvent();\r\n                    return false;\r\n                } else if (key === \"Home\") {\r\n                    var liElem = this.getFirstVisibleItem();\r\n                    if (!liElem) return false;\r\n                    this.setSelect(liElem, true);\r\n                    this.sendSelectEvent();\r\n                    return false;\r\n                } else if (key === \"End\") {\r\n                    var liElem = this.getLastVisibleItem();\r\n                    if (!liElem) return false;\r\n                    this.setSelect(liElem, true);\r\n                    this.sendSelectEvent();\r\n                    return false;\r\n                } else if (key === \"ArrowLeft\" || key === \"Left\") {\r\n                    var liElem = this.getSelect();\r\n                    if (!liElem) return false;\r\n                    if (this.canCollapse(liElem))\r\n                        this.collapse(liElem);\r\n                    else {\r\n                        liElem = this.getPrevVisibleEntry(liElem);\r\n                        if (!liElem) return false;\r\n                        this.setSelect(liElem, true);\r\n                        this.sendSelectEvent();\r\n                    }\r\n                    return false;\r\n                } else if (key === \"ArrowRight\" || key === \"Right\") {\r\n                    var liElem = this.getSelect();\r\n                    if (!liElem) return false;\r\n                    if (this.canExpand(liElem))\r\n                        this.expand(liElem);\r\n                    else {\r\n                        liElem = this.getNextVisibleEntry(liElem);\r\n                        if (!liElem) return false;\r\n                        this.setSelect(liElem, true);\r\n                        this.sendSelectEvent();\r\n                    }\r\n                    return false;\r\n                } else if (key === \"Enter\") {\r\n                    var liElem = this.getSelect();\r\n                    if (!liElem) return false;\r\n                    this.sendClickEvent();\r\n                    return false;\r\n                }\r\n                return true;\r\n            });\r\n        }\r\n\r\n        private sendClickEvent(): void {\r\n            setTimeout((): void => {\r\n                var event = document.createEvent(\"Event\");\r\n                event.initEvent(\"tree_click\", true, true);\r\n                this.Control.dispatchEvent(event);\r\n            }, 1);\r\n        }\r\n\r\n        private sendSelectEvent(): void {\r\n            setTimeout((): void => {\r\n                var event = document.createEvent(\"Event\");\r\n                event.initEvent(\"tree_select\", true, true);\r\n                this.Control.dispatchEvent(event);\r\n            }, 1);\r\n        }\r\n\r\n        private sendDropEvent(): void {\r\n            setTimeout((): void => {\r\n                var event = document.createEvent(\"Event\");\r\n                event.initEvent(\"tree_drop\", true, true);\r\n                this.Control.dispatchEvent(event);\r\n            }, 1);\r\n        }\r\n\r\n        /* Drag & Drop */\r\n\r\n        public dragStart(ev: DragEvent): void {\r\n            var li = $YetaWF.elementClosest(ev.target as HTMLElement, \"li\") as HTMLLIElement;\r\n            this.DDSource = li;\r\n            this.DDSourceAnchor = ev.target as HTMLAnchorElement;\r\n            ev.dataTransfer!.setData(\"tree\", \"tree\");\r\n            ev.dataTransfer!.setDragImage(this.DDSourceAnchor, 0, 0);\r\n        }\r\n        public dragOver(ev: DragEvent): void {\r\n            var liTarget = $YetaWF.elementClosestCond(ev.target as HTMLElement, \"li\") as HTMLLIElement;\r\n            if (liTarget) {\r\n                var ddTargetAnchor = ev.target as HTMLAnchorElement;\r\n                if (ddTargetAnchor.tagName.toLowerCase() === \"a\") {\r\n                    if (ddTargetAnchor !== this.DDSourceAnchor && !this.DDSource!.contains(ddTargetAnchor)) {\r\n                        var targetRect = ddTargetAnchor.getBoundingClientRect();\r\n                        if (this.getFirstDirectChild(liTarget) != null) {\r\n                            this.setDragDropTarget(liTarget, ddTargetAnchor, TargetPositionEnum.before);\r\n                        } else {\r\n                            var third = targetRect.height / 3;\r\n                            if (ev.offsetY < third)\r\n                                this.setDragDropTarget(liTarget, ddTargetAnchor, TargetPositionEnum.before);\r\n                            else if (ev.offsetY > 2 * third)\r\n                                this.setDragDropTarget(liTarget, ddTargetAnchor, TargetPositionEnum.after);\r\n                            else\r\n                                this.setDragDropTarget(liTarget, ddTargetAnchor, TargetPositionEnum.on);\r\n                        }\r\n                        ev.dataTransfer!.dropEffect = \"move\";\r\n                        ev.preventDefault();\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n            this.setDragDropTarget(null);\r\n        }\r\n        private setDragDropTarget(liTarget: HTMLLIElement | null, targetAnchor?: HTMLAnchorElement, position?: TargetPositionEnum): void {\r\n\r\n            if (this.DDLastTargetAnchor) {\r\n                var divPos = $YetaWF.getElement1BySelector(\".t_ddpos\", [this.DDLastTargetAnchor]);\r\n                divPos.remove();\r\n            }\r\n            this.DDLastTarget = null;\r\n            this.DDLastTargetAnchor = null;\r\n\r\n            if (liTarget) {\r\n                this.DDLastTarget = liTarget;\r\n                this.DDLastTargetAnchor = targetAnchor!;\r\n                this.DDTargetPosition = position || TargetPositionEnum.on;\r\n                var pos = \"\";\r\n                switch (position) {\r\n                    default:\r\n                    case TargetPositionEnum.on: pos = \"on\"; break;\r\n                    case TargetPositionEnum.before: pos = \"before\"; break;\r\n                    case TargetPositionEnum.after: pos = \"after\"; break;\r\n                }\r\n                this.DDLastTargetAnchor.insertAdjacentHTML(\"afterbegin\", `<div class=\"t_ddpos t_${pos}\"></div>`);\r\n            }\r\n        }\r\n        public drop(ev: DragEvent): void {\r\n            if (this.DDSource && this.DDLastTarget && this.DDLastTargetAnchor) {\r\n\r\n                // find the source item's parent ul in case it's the only item so we can update expand/collapse and file/folder icons\r\n                var parentUl = $YetaWF.elementClosest(this.DDSource, \"ul\");\r\n\r\n                switch (this.DDTargetPosition) {\r\n                    default:\r\n                    case TargetPositionEnum.on:\r\n                        // we're droppiong on an item, that means it has no child items yet\r\n                        // add ul\r\n                        var ul = document.createElement(\"ul\");\r\n                        // source items to up\r\n                        ul.appendChild(this.DDSource);\r\n                        // all ul & child items to target\r\n                        this.DDLastTarget.insertAdjacentElement(\"beforeend\", ul);\r\n\r\n                        // update target's file/folder icon (now a folder)\r\n                        var iElem = $YetaWF.getElement1BySelector(\"i.t_icfile\", [this.DDLastTarget]);\r\n                        $YetaWF.elementRemoveClass(iElem, \"t_icfile\");\r\n                        $YetaWF.elementAddClass(iElem, \"t_icfolder\");\r\n\r\n                        // update target's expand/collapse icon (now expanded)\r\n                        iElem = $YetaWF.getElement1BySelector(\"i.t_icempty\", [this.DDLastTarget]);\r\n                        $YetaWF.elementAddClass(iElem, \"t_icdown\");\r\n                        break;\r\n                    case TargetPositionEnum.before:\r\n                        this.DDLastTarget.insertAdjacentElement(\"beforebegin\", this.DDSource);\r\n                        break;\r\n                    case TargetPositionEnum.after:\r\n                        this.DDLastTarget.insertAdjacentElement(\"afterend\", this.DDSource);\r\n                        break;\r\n                }\r\n                // Update the source's parent item in case we moved the only child items in which case we need to update expand/collapse and file/folder icons\r\n                while (parentUl) {\r\n                    if (parentUl.childElementCount === 0) {\r\n                        if (!$YetaWF.elementHasClass(parentUl, \"tg_root\")) {\r\n                            var liElem = parentUl.parentElement as HTMLLIElement;\r\n                            // remove the empty ul element\r\n                            parentUl.remove();\r\n                            // update target's file/folder icon (now a file)\r\n                            var iElem = $YetaWF.getElement1BySelector(\"i.t_icfolder\", [liElem]);\r\n                            $YetaWF.elementRemoveClass(iElem, \"t_icfolder\");\r\n                            $YetaWF.elementAddClass(iElem, \"t_icfile\");\r\n\r\n                            // update target's expand/collapse icon (now expanded)\r\n                            iElem = $YetaWF.getElement1BySelector(\"i.t_icdown\", [liElem]);\r\n                            $YetaWF.elementRemoveClass(iElem, \"t_icdown\");\r\n                            $YetaWF.elementAddClass(iElem, \"t_icempty\");\r\n\r\n                            parentUl = liElem.parentElement as HTMLUListElement;\r\n                        }\r\n                    } else\r\n                        break;\r\n                }\r\n                this.sendDropEvent();\r\n            }\r\n            this.setDragDropTarget(null);\r\n            this.DDSource = null;\r\n            this.DDSourceAnchor = null;\r\n        }\r\n        public dragEnd(ev: DragEvent): void {\r\n            this.setDragDropTarget(null);\r\n            this.DDSource = null;\r\n            this.DDSourceAnchor = null;\r\n        }\r\n\r\n        public static onDragStart(ev: DragEvent): void {\r\n            TreeComponent.DDTree = YetaWF.ComponentBaseDataImpl.getControlFromTag<TreeComponent>(ev.target as HTMLElement, TreeComponent.SELECTOR);\r\n            TreeComponent.DDTree.dragStart(ev);\r\n        }\r\n        public static onDragOver(ev: DragEvent): void {\r\n            if (TreeComponent.DDTree) {\r\n                TreeComponent.DDTree.dragOver(ev);\r\n            }\r\n        }\r\n        public static onDrop(ev: DragEvent): void {\r\n            if (TreeComponent.DDTree) {\r\n                TreeComponent.DDTree.drop(ev);\r\n            }\r\n            TreeComponent.DDTree = null;\r\n        }\r\n        public static onDragEnd(ev: DragEvent): void {\r\n            if (TreeComponent.DDTree)\r\n                TreeComponent.DDTree.dragEnd(ev);\r\n            TreeComponent.DDTree = null;\r\n        }\r\n\r\n        // API\r\n\r\n        public canCollapse(liElem: HTMLLIElement): boolean {\r\n            var ul = $YetaWF.getElement1BySelectorCond(\"ul\", [liElem]); // get the subitems\r\n            if (!ul || ul.style.display !== \"\") return false;\r\n            return true;\r\n        }\r\n        public collapse(liElem: HTMLLIElement): void {\r\n            var ul = $YetaWF.getElement1BySelector(\"ul\", [liElem]); // get the subitems\r\n            ul.style.display = \"none\";\r\n            var iElem = $YetaWF.getElement1BySelector(\"i.t_icdown\", [liElem]);\r\n            $YetaWF.elementRemoveClass(iElem, \"t_icdown\");\r\n            $YetaWF.elementAddClass(iElem, \"t_icright\");\r\n        }\r\n        public canExpand(liElem: HTMLLIElement): boolean {\r\n            var ul = $YetaWF.getElement1BySelectorCond(\"ul\", [liElem]); // get the subitems\r\n            if (!ul || ul.style.display === \"\") return false;\r\n            return true;\r\n        }\r\n        public expand(liElem: HTMLLIElement): void {\r\n            var ul = $YetaWF.getElement1BySelector(\"ul\", [liElem]); // get the subitems\r\n            ul.style.display = \"\";\r\n            var iElem = $YetaWF.getElement1BySelector(\"i.t_icright\", [liElem]);\r\n            $YetaWF.elementRemoveClass(iElem, \"t_icright\");\r\n            $YetaWF.elementAddClass(iElem, \"t_icdown\");\r\n        }\r\n        public expandAll(): void {\r\n            var li = this.getFirstVisibleItem();\r\n            while (li) {\r\n                if (this.canExpand(li))\r\n                    this.expand(li);\r\n                li = this.getNextVisibleEntry(li);\r\n            }\r\n        }\r\n        public collapseAll(): void {\r\n            var li = this.getFirstVisibleItem();\r\n            while (li) {\r\n                if (this.canCollapse(li))\r\n                    this.collapse(li);\r\n                li = this.getNextEntry(li);\r\n            }\r\n        }\r\n        public getElementData(liElem: HTMLLIElement): any {\r\n            if (!this.Setup.StaticData) throw \"no static data\";\r\n            var rec = Number($YetaWF.getAttribute(liElem, \"data-record\"));\r\n            if (rec < 0 || rec >= this.Setup.StaticData.length)\r\n                throw `Unexpected record # ${rec} in ${liElem.outerHTML}`;\r\n            return this.Setup.StaticData[rec];\r\n        }\r\n        public getSelect(): HTMLLIElement | null {\r\n            var entry = $YetaWF.getElement1BySelectorCond(\".t_entry.t_select\", [this.Control]) as HTMLElement;\r\n            if (!entry) return null;\r\n            var liElem = $YetaWF.elementClosest(entry, \"li\") as HTMLLIElement | null;\r\n            return liElem;\r\n        }\r\n        public setSelect(liElem: HTMLLIElement, focus?:boolean): void {\r\n            this.clearSelect();\r\n            var entry = $YetaWF.getElement1BySelector(\".t_entry\", [liElem]);\r\n            $YetaWF.elementAddClass(entry, \"t_select\");\r\n            if (focus === true)\r\n                entry.focus();\r\n        }\r\n        public getSelectData(): any | null {\r\n            if (!this.Setup.StaticData) throw \"no static data\";\r\n            var liElem = this.getSelect();\r\n            if (!liElem) return null;\r\n            var rec = Number($YetaWF.getAttribute(liElem, \"data-record\"));\r\n            if (rec < 0 || rec >= this.Setup.StaticData.length) return null;\r\n            return this.Setup.StaticData[rec];\r\n        }\r\n        public getSelectText(): string {\r\n            var entry = $YetaWF.getElement1BySelector(\".t_entry.t_select\", [this.Control]) as HTMLElement;\r\n            return entry.innerText;\r\n        }\r\n        public setSelectText(text: string): void {\r\n            var entry = $YetaWF.getElement1BySelector(\".t_entry.t_select\", [this.Control]) as HTMLElement;\r\n            entry.innerText = text;\r\n        }\r\n        public clearSelect(): void {\r\n            var entries = $YetaWF.getElementsBySelector(\".t_entry.t_select\", [this.Control]);\r\n            for (let entry of entries)\r\n                $YetaWF.elementRemoveClass(entry, \"t_select\");\r\n        }\r\n        public removeEntry(liElem: HTMLLIElement): void {\r\n            if (!this.Setup.StaticData) throw \"no static data\";\r\n            var rec = Number($YetaWF.getAttribute(liElem, \"data-record\"));\r\n            if (rec < 0 || rec >= this.Setup.StaticData.length) return;\r\n\r\n            // remove the record(s) from static data (including child items)\r\n            this.DeletedRecords.push(rec);\r\n            this.Setup.StaticData[rec] = null;\r\n            var childLis = $YetaWF.getElementsBySelector(\"li\", [liElem]) as HTMLLIElement[];\r\n            for (let childLi of childLis) {\r\n                rec = Number($YetaWF.getAttribute(childLi, \"data-record\"));\r\n                if (rec < 0 || rec >= this.Setup.StaticData.length)\r\n                    throw `Unexpected record # ${rec} in ${childLi.outerHTML}`;\r\n                this.DeletedRecords.push(rec);\r\n            }\r\n\r\n            // remove li element (and possibly parent(s))\r\n            var ul = $YetaWF.elementClosest(liElem, \"ul\") as HTMLUListElement | null;\r\n            liElem.remove();\r\n            for (; ;) {\r\n                if (!ul) break;\r\n                if (ul.children.length > 0)\r\n                    break;\r\n                if ($YetaWF.elementHasClass(ul, \"tg_root\"))\r\n                    break;\r\n                var parentUl = $YetaWF.elementClosest(ul.parentElement!, \"ul\") as HTMLUListElement | null;\r\n                ul.remove();\r\n                ul = parentUl;\r\n            }\r\n        }\r\n        public getNextSibling(liElem: HTMLLIElement): HTMLLIElement | null {\r\n            var li = liElem.nextElementSibling as HTMLLIElement | null;\r\n            return li;\r\n        }\r\n        public getPrevSibling(liElem: HTMLLIElement): HTMLLIElement | null {\r\n            var li = liElem.previousElementSibling as HTMLLIElement | null;\r\n            return li;\r\n        }\r\n        public getFirstDirectChild(liElem: HTMLLIElement): HTMLLIElement | null {\r\n            var ul = $YetaWF.getElement1BySelectorCond(\"ul\", [liElem]) as HTMLUListElement | null;\r\n            if (ul)\r\n                return ul.children[0] as HTMLLIElement;\r\n            return null;\r\n        }\r\n        public getLastDirectChild(liElem: HTMLLIElement): HTMLLIElement | null {\r\n            var ul = $YetaWF.getElement1BySelectorCond(\"ul\", [liElem]) as HTMLUListElement | null;\r\n            if (ul)\r\n                return ul.children[ul.children.length - 1] as HTMLLIElement;\r\n            return null;\r\n        }\r\n        public getNextEntry(liElem: HTMLLIElement): HTMLLIElement | null {\r\n            var ul = $YetaWF.getElement1BySelectorCond(\"ul\", [liElem]) as HTMLUListElement | null;\r\n            // get item in subentries\r\n            if (ul)\r\n                return ul.children[0] as HTMLLIElement;\r\n            // no subentries, try next sibling (work your way up the tree)\r\n            for (; ;) {\r\n                var li = liElem.nextElementSibling as HTMLLIElement | null;\r\n                if (li)\r\n                    return li;\r\n                // no next sibling, go to ul and parent il\r\n                ul = liElem.parentElement as HTMLUListElement;\r\n                if ($YetaWF.elementHasClass(ul, \"tg_root\"))\r\n                    return null;\r\n                li = $YetaWF.elementClosest(ul, \"li\") as HTMLLIElement | null;\r\n                if (!li)\r\n                    return null;\r\n                liElem = li;\r\n            }\r\n        }\r\n        public getNextVisibleEntry(liElem: HTMLLIElement): HTMLLIElement | null {\r\n            var ul = $YetaWF.getElement1BySelectorCond(\"ul\", [liElem]) as HTMLUListElement | null;\r\n            // get item in subentries\r\n            if (ul && ul.style.display === \"\")\r\n                return ul.children[0] as HTMLLIElement;\r\n            // no subentries, try next sibling (work your way up the tree)\r\n            for (; ;) {\r\n                var li = liElem.nextElementSibling as HTMLLIElement | null;\r\n                if (li)\r\n                    return li;\r\n                // no next sibling, go to ul and parent il\r\n                ul = liElem.parentElement as HTMLUListElement;\r\n                if ($YetaWF.elementHasClass(ul, \"tg_root\"))\r\n                    return null;\r\n                li = $YetaWF.elementClosest(ul, \"li\") as HTMLLIElement | null;\r\n                if (!li)\r\n                    return null;\r\n                liElem = li;\r\n            }\r\n        }\r\n        public getPrevEntry(liElem: HTMLLIElement): HTMLLIElement | null {\r\n            var li: HTMLLIElement | null = liElem.previousElementSibling as HTMLLIElement | null;\r\n            if (li) {\r\n                var ul = $YetaWF.getElement1BySelectorCond(\"ul\", [li]) as HTMLUListElement | null;\r\n                if (ul)\r\n                    return ul.children[ul.children.length - 1] as HTMLLIElement | null;\r\n                return li;\r\n            }\r\n            ul = liElem.parentElement as HTMLUListElement;\r\n            if ($YetaWF.elementHasClass(ul, \"tg_root\"))\r\n                return null;\r\n            li = $YetaWF.elementClosest(ul, \"li\") as HTMLLIElement | null;\r\n            if (!li)\r\n                return null;\r\n            return li;\r\n        }\r\n        public getPrevVisibleEntry(liElem: HTMLLIElement): HTMLLIElement | null {\r\n            var li: HTMLLIElement | null = liElem.previousElementSibling as HTMLLIElement | null;\r\n            if (li) {\r\n                for (; ;) {\r\n                    var ul = $YetaWF.getElement1BySelectorCond(\"ul\", [li]) as HTMLUListElement | null;\r\n                    if (!ul || ul.style.display !== \"\")\r\n                        return li;\r\n                    li = ul.children[ul.children.length - 1] as HTMLLIElement;\r\n                }\r\n            }\r\n            ul = liElem.parentElement as HTMLUListElement;\r\n            if ($YetaWF.elementHasClass(ul, \"tg_root\"))\r\n                return null;\r\n            li = $YetaWF.elementClosest(ul, \"li\") as HTMLLIElement | null;\r\n            if (!li)\r\n                return null;\r\n            return li;\r\n        }\r\n        public getFirstVisibleItem(): HTMLLIElement | null {\r\n            var liElem = $YetaWF.getElement1BySelectorCond(\"ul li\", [this.Control]) as HTMLLIElement | null;\r\n            return liElem;\r\n        }\r\n        public getLastVisibleItem(): HTMLLIElement | null {\r\n\r\n            var ul: HTMLUListElement | null = $YetaWF.getElement1BySelector(\"ul.tg_root\", [this.Control]) as HTMLUListElement;\r\n            var liElem: HTMLLIElement | null = null;\r\n            for (; ;) {\r\n                if (!ul || ul.style.display !== \"\")\r\n                    break;\r\n                // get last item in subentries\r\n                liElem = ul.children[ul.children.length - 1] as HTMLLIElement;\r\n\r\n                ul = $YetaWF.getElement1BySelectorCond(\"ul\", [liElem]) as HTMLUListElement | null;\r\n            }\r\n            return liElem;\r\n        }\r\n        public addEntry(liElem: HTMLLIElement, text:string, data: any): HTMLLIElement {\r\n            var text = $YetaWF.htmlEscape(text);\r\n            var entry = this.getNewEntry(text, data);\r\n            liElem.insertAdjacentHTML(\"afterend\", entry);\r\n            return this.getNextSibling(liElem)!;\r\n        }\r\n        public insertEntry(liElem: HTMLLIElement, text: string, data: any): HTMLLIElement {\r\n            var text = $YetaWF.htmlEscape(text);\r\n            var entry = this.getNewEntry(text, data);\r\n            liElem.insertAdjacentHTML(\"beforebegin\", entry);\r\n            return this.getPrevSibling(liElem)!;\r\n        }\r\n        private getNewEntry(text: string, data: any): string {\r\n            var rec = this.getAvailableRecord(data);\r\n            var dd = \"\";\r\n            if (this.Setup.DragDrop)\r\n                dd = \" draggable='true' ondrop='YetaWF_ComponentsHTML.TreeComponent.onDrop(event)' ondragover='YetaWF_ComponentsHTML.TreeComponent.onDragOver(event)' ondragstart='YetaWF_ComponentsHTML.TreeComponent.onDragStart(event)'\";\r\n            var entry = `<li data-record=\"${rec}\"><i class=\"t_icempty\"></i> <i class=\"t_icfile\"></i><a class=\"t_entry\" href=\"#\"${dd}>${text}</a></li>`;\r\n            return entry;\r\n        }\r\n        private getAvailableRecord(data: any): number {\r\n            if (!this.Setup.StaticData) throw \"no static data\";\r\n            var rec: number;\r\n            if (this.DeletedRecords.length > 0) {\r\n                rec = this.DeletedRecords[0];\r\n                this.DeletedRecords.splice(0, 1);\r\n                this.Setup.StaticData[rec] = data;\r\n            } else {\r\n                rec = this.Setup.StaticData.length;\r\n                this.Setup.StaticData.push(data);\r\n            }\r\n            return rec;\r\n        }\r\n\r\n        /** Scroll the selected item into the viewable area */\r\n        public scrollIntoView(container: HTMLElement): void {\r\n            var liElem = this.getSelect();\r\n            if (!liElem) return;\r\n            var rectLi = liElem.getBoundingClientRect();\r\n            var rectContainer = container.getBoundingClientRect();\r\n            container.scrollTop = rectLi.top - rectContainer.height / 2;\r\n        }\r\n    }\r\n\r\n    // A <div> is being emptied. Destroy all trees the <div> may contain.\r\n    $YetaWF.registerClearDiv((tag: HTMLElement): void => {\r\n        YetaWF.ComponentBaseDataImpl.clearDiv<TreeComponent>(tag, TreeComponent.SELECTOR);\r\n    });\r\n}\r\n"]}