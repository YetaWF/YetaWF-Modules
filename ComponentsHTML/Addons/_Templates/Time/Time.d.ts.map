{"version":3,"sources":["Addons/YetaWF/ComponentsHTML/_Templates/Time/Time.tsx"],"names":[],"mappings":"AAEA,kBAAU,qBAAqB,CAAC;IAE5B,UAAiB,iBAAiB;QAC9B,UAAU,EAAE,MAAM,CAAC;KACtB;IAED,MAAa,aAAa;QAEtB,OAAO,CAAC,OAAO;QAKf,OAAO,CAAC,UAAU;QAKlB,OAAO,CAAC,SAAS;QAKjB,OAAO,CAAC,SAAS;QAOjB,OAAO,CAAC,aAAa;QAGrB,OAAO,CAAC,OAAO;QAMf;;;WAGG;QACI,IAAI,CAAC,MAAM,EAAE,MAAM,GAAG,IAAI;QAgCjC;;;;WAIG;QACI,kBAAkB,CAAC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,WAAW,GAAG,IAAI;KAmCrE;CAWJ","file":"Time.d.ts","sourcesContent":["/* Copyright Â© 2019 Softel vdm, Inc. - https://yetawf.com/Documentation/YetaWF/ComponentsHTML#License */\r\n\r\nnamespace YetaWF_ComponentsHTML {\r\n\r\n    export interface IPackageVolatiles {\r\n        TimeFormat: string;\r\n    }\r\n\r\n    export class TimeComponent {\r\n\r\n        private getGrid(ctrlId: string): HTMLElement {\r\n            var el: HTMLElement | null = document.getElementById(ctrlId);\r\n            if (el == null) throw `Grid element ${ctrlId} not found`;/*DEBUG*/\r\n            return el;\r\n        }\r\n        private getControl(ctrlId: string): HTMLElement {\r\n            var el: HTMLElement | null = document.getElementById(ctrlId);\r\n            if (el == null) throw `Element ${ctrlId} not found`;/*DEBUG*/\r\n            return el;\r\n        }\r\n        private getHidden(ctrl: HTMLElement): HTMLElement {\r\n            var hidden: HTMLElement | null = ctrl.querySelector(\"input[type=\\\"hidden\\\"]\") as HTMLElement;\r\n            if (hidden == null) throw \"Couldn't find hidden field\";/*DEBUG*/\r\n            return hidden;\r\n        }\r\n        private setHidden(hidden: HTMLElement, dateVal: Date): void {\r\n            var s: string = \"\";\r\n            if (dateVal != null) {\r\n                s = dateVal.toISOString();\r\n            }\r\n            hidden.setAttribute(\"value\", s);\r\n        }\r\n        private setHiddenText(hidden: HTMLElement, dateVal: string | null): void {\r\n            hidden.setAttribute(\"value\", dateVal ? dateVal : \"\");\r\n        }\r\n        private getDate(ctrl: HTMLElement): HTMLElement {\r\n            var date: HTMLElement = ctrl.querySelector(\"input[name=\\\"dtpicker\\\"]\") as HTMLElement;\r\n            if (date == null) throw \"Couldn't find time field\";/*DEBUG*/\r\n            return date;\r\n        }\r\n\r\n        /**\r\n         * Initializes one instance of a Date template control.\r\n         * @param ctrlId - The HTML id of the date template control.\r\n         */\r\n        public init(ctrlId: string): void {\r\n            var thisObj: TimeComponent = this;\r\n            var ctrl: HTMLElement = this.getControl(ctrlId);\r\n            var hidden: HTMLElement = this.getHidden(ctrl);\r\n            var date: HTMLElement = this.getDate(ctrl);\r\n            $(date).kendoTimePicker({\r\n                animation: false,\r\n                format: YVolatile.YetaWF_ComponentsHTML.TimeFormat,\r\n                culture: YVolatile.Basics.Language,\r\n                change: (ev: kendo.ui.TimePickerEvent): void => {\r\n                    var kdPicker: kendo.ui.TimePicker = ev.sender;\r\n                    var val: Date = kdPicker.value();\r\n                    if (val == null)\r\n                        thisObj.setHiddenText(hidden, kdPicker.element.val() as string);\r\n                    else\r\n                        thisObj.setHidden(hidden, val);\r\n                    FormsSupport.validateElement(hidden);\r\n                }\r\n            });\r\n            var kdPicker: kendo.ui.TimePicker = $(date).data(\"kendoTimePicker\") as kendo.ui.TimePicker;\r\n            this.setHidden(hidden, kdPicker.value());\r\n\r\n            date.addEventListener(\"change\", (event: Event): void => {\r\n                var val: Date = kdPicker.value();\r\n                if (val == null)\r\n                    thisObj.setHiddenText(hidden, (event.target as HTMLInputElement).value);\r\n                else\r\n                    thisObj.setHidden(hidden, val);\r\n                FormsSupport.validateElement(hidden);\r\n            }, false);\r\n        }\r\n\r\n        /**\r\n         * Renders a time picker in the jqGrid filter toolbar.\r\n         * @param gridId - The id of the grid containing the date picker.\r\n         * @param elem - The element containing the date value.\r\n         */\r\n        public renderjqGridFilter(gridId: string, elem: HTMLElement): void {\r\n            var grid: HTMLElement = this.getGrid(gridId);\r\n            // Build a kendo time picker\r\n            // We have to add it next to the jqgrid provided input field elem\r\n            // We can't use the jqgrid provided element as a kendoTimePicker because jqgrid gets confused and\r\n            // uses the wrong sorting option. So we add the timepicker next to the \"official\" input field (which we hide)\r\n            var dtPick: HTMLElement = <input name=\"dtpicker\" />;\r\n            elem.insertAdjacentElement(\"afterend\", dtPick);\r\n            // Hide the jqgrid provided input element (we update the time in this hidden element)\r\n            elem.style.display = \"none\";\r\n\r\n            // init time picker\r\n            $(dtPick).kendoTimePicker({\r\n                animation: false,\r\n                format: YVolatile.YetaWF_ComponentsHTML.TimeFormat,\r\n                culture: YVolatile.Basics.Language,\r\n                change: (ev: kendo.ui.TimePickerEvent) : void => {\r\n                    var kdPicker: kendo.ui.TimePicker = ev.sender;\r\n                    var val: Date = kdPicker.value();\r\n                    var s: string = \"\";\r\n                    if (val !== null) {\r\n                        s = val.toISOString();\r\n                    }\r\n                    elem.setAttribute(\"value\", s);\r\n                }\r\n            });\r\n            /**\r\n             * Handles Return key in time picker, part of jqGrid filter toolbar.\r\n             * @param event\r\n             */\r\n            dtPick.addEventListener(\"keydown\", (event: KeyboardEvent): void => {\r\n                if (event.keyCode === 13)\r\n                    (grid as any).triggerToolbar();\r\n            }, false);\r\n        }\r\n    }\r\n\r\n    // A <div> is being emptied. Destroy all time pickers the <div> may contain.\r\n    $YetaWF.registerClearDiv((tag: HTMLElement): void => {\r\n        var list: HTMLElement[] = $YetaWF.getElementsBySelector(\".yt_time.t_edit input[name=\\\"dtpicker\\\"]\", [tag]);\r\n        for (let el of list) {\r\n            var timepicker: kendo.ui.TimePicker = $(el).data(\"kendoTimePicker\");\r\n            if (!timepicker) throw \"No kendo object found\";/*DEBUG*/\r\n            timepicker.destroy();\r\n        }\r\n    });\r\n}\r\n\r\n"]}