{"version":3,"sources":["Addons/YetaWF/ComponentsHTML/_Templates/ActionIcons/ActionIcons.ts"],"names":[],"mappings":"AAEA,kBAAU,qBAAqB,CAAC;IAE5B,UAAU,gBAAgB;QACtB,MAAM,EAAE,MAAM,CAAC;KAClB;IAED,MAAa,oBAAqB,SAAQ,MAAM,CAAC,iBAAiB;QAE9D,OAAO,CAAC,WAAW,CAAiB;QAEpC,OAAc,SAAS,EAAE,MAAM,CAAK;oBAExB,SAAS,EAAE,MAAM,EAAE,KAAK,EAAE,gBAAgB;QAoBtD,OAAO,CAAC,QAAQ;eAaF,UAAU,IAAI,IAAI;eAKlB,eAAe,CAAC,KAAK,EAAE,WAAW,EAAE,GAAG,IAAI;KAW5D;CA6CJ","file":"ActionIcons.d.ts","sourcesContent":["/* Copyright Â© 2019 Softel vdm, Inc. - https://yetawf.com/Documentation/YetaWF/ComponentsHTML#License */\r\n\r\nnamespace YetaWF_ComponentsHTML {\r\n\r\n    interface ActionIconsSetup {\r\n        MenuId: string;\r\n    }\r\n\r\n    export class ActionIconsComponent extends YetaWF.ComponentBaseImpl {\r\n\r\n        private MenuControl: HTMLDivElement;\r\n\r\n        public static menusOpen: number = 0;\r\n\r\n        constructor(controlId: string, setup: ActionIconsSetup) {\r\n            super(controlId);\r\n\r\n            this.MenuControl = $YetaWF.getElementById(setup.MenuId) as HTMLDivElement;\r\n\r\n            var $btn = $(this.Control).kendoButton();\r\n            $btn.on(\"click\", (ev: Event): boolean => {\r\n                var vis = $YetaWF.isVisible(this.MenuControl);\r\n                ActionIconsComponent.closeMenus();\r\n                if (!vis)\r\n                    this.openMenu();\r\n                ev.preventDefault();\r\n                return false;\r\n            });\r\n\r\n            $(this.MenuControl).kendoMenu({\r\n                orientation: \"vertical\"\r\n            }).hide();\r\n        }\r\n\r\n        private openMenu(): void {\r\n            ActionIconsComponent.closeMenus();\r\n            var $idMenu = $(this.MenuControl);\r\n            $idMenu.appendTo($(\"body\"));\r\n            $idMenu.show();\r\n            ++ActionIconsComponent.menusOpen;\r\n            $idMenu.position({ //jQuery-ui use\r\n                my: \"left top\",\r\n                at: \"left bottom\",\r\n                of: $(this.Control),\r\n                collision: \"flip\"\r\n            });\r\n        }\r\n        public static closeMenus(): void {\r\n            // find all action menus after grid (there really should only be one)\r\n            var menus = $YetaWF.getElementsBySelector(\".yGridActionMenu\");\r\n            ActionIconsComponent.closeMenusGiven(menus);\r\n        }\r\n        public static closeMenusGiven(menus: HTMLElement[]): void {\r\n            ActionIconsComponent.menusOpen = 0;\r\n            for (let menu of menus) {\r\n                $(menu).hide();\r\n                var idButton = $YetaWF.getAttribute(menu, \"id\").replace(\"_menu\", \"_btn\");\r\n                var button = $YetaWF.getElementByIdCond(idButton);\r\n                if (button) { // there can be a case without button if we switched to a new page\r\n                    $(menu).appendTo(button.parentElement as HTMLElement);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // Handle clicks elsewhere so we can close the menus\r\n    $YetaWF.registerMultipleEventHandlersBody([\"click\", \"mousedown\"], null, (ev: Event): boolean => {\r\n        var e = ev as MouseEvent;\r\n        if (e.which !== 1) return true;\r\n        if (ActionIconsComponent.menusOpen > 0) {\r\n            var menus = $YetaWF.getElementsBySelector(\".yGridActionMenu\");// get all action menus\r\n            menus = $YetaWF.limitToVisibleOnly(menus);\r\n            // delay closing to handle the event\r\n            setTimeout(():void => {\r\n                ActionIconsComponent.closeMenusGiven(menus);\r\n            }, 300);\r\n        }\r\n        return true;\r\n    });\r\n    // Handle Escape key to close any open menus\r\n    $YetaWF.registerEventHandlerBody(\"keydown\", null, (ev: KeyboardEvent): boolean => {\r\n        if (ev.which !== 27) return true;\r\n        ActionIconsComponent.closeMenus();\r\n        return true;\r\n    });\r\n\r\n    // last chance - handle a new page (UPS) and close open menus\r\n    $YetaWF.registerNewPage((url:string): void => {\r\n        ActionIconsComponent.closeMenus();\r\n    });\r\n\r\n    // A <div> is being emptied. Destroy all actionicons the <div> may contain.\r\n    $YetaWF.registerClearDiv((tag: HTMLElement): void => {\r\n        //var list = tag.querySelectorAll(\"button.yt_actionicons\");\r\n        //var len = list.length;\r\n        //for (var i = 0; i < len; ++i) {\r\n        //    var el = list[i];\r\n        //    var button = $(el).data(\"kendoButton\");\r\n        //    if (!button) throw \"No kendo object found\";/*DEBUG*/\r\n        //    button.destroy();\r\n        //}\r\n        var list = $YetaWF.getElementsBySelector(\"ul.yGridActionMenu\", [tag]);\r\n        for (let el of list) {\r\n            var menu = $(el).data(\"kendoMenu\");\r\n            if (!menu) throw \"No kendo object found\";/*DEBUG*/\r\n            menu.destroy();\r\n        }\r\n    });\r\n}\r\n\r\n"]}