{"version":3,"sources":["AddOns/YetaWF/ComponentsHTML/_Main/Tooltips.ts"],"names":[],"mappings":"AAEA,kBAAU,qBAAqB,CAAC;IAE5B,MAAa,QAAQ;eAEH,IAAI,IAAI,IAAI;eAiEZ,cAAc,IAAI,IAAI;KAGvC;CACJ","file":"Tooltips.d.ts","sourcesContent":["/* Copyright Â© 2019 Softel vdm, Inc. - https://yetawf.com/Documentation/YetaWF/ComponentsHTML#License */\r\n\r\nnamespace YetaWF_ComponentsHTML {\r\n\r\n    export class Tooltips {\r\n\r\n        public static init(): void {\r\n\r\n            const a1 = YVolatile.Basics.CssNoTooltips;\r\n            const a2 = YConfigs.Basics.CssTooltip;\r\n            const a3 = YConfigs.Basics.CssTooltipSpan;\r\n            const selectors = `img:not(\"${a1}\"),label,input:not(\".ui-button-disabled\"),a:not(\"${a1},.ui-button-disabled\"),i:not(\"${a1}\"),.ui-jqgrid span[${a2}],th[${a2}],span[${a3}],li[${a2}],div[${a2}]`;\r\n            const ddsel = \".k-list-container.k-popup li[data-offset-index]\";\r\n            $(\"body\").tooltip({ //jQuery-ui use\r\n                items: (selectors + \",\" + ddsel),\r\n                content: function (a: any, b: any, c: any) : string|null {\r\n                    var $this = $(this as HTMLElement);\r\n                    if ($this.is(ddsel)) {\r\n                        // dropdown list - find who owns this and get the matching tooltip\r\n                        // this is a bit hairy - we save all the tooltips for a dropdown list in a variable\r\n                        // named ..id.._tooltips. The popup/dropdown is named ..id..-list so we deduce the\r\n                        // variable name from the popup/dropdown. This is going to break at some point...\r\n                        const ttindex = $YetaWF.getAttributeCond(this as HTMLElement, \"data-offset-index\");\r\n                        if (!ttindex) return null;\r\n                        const $container = $this.closest(\".k-list-container.k-popup\");\r\n                        if ($container.length !== 1) return null;\r\n                        var id = $container.attr(\"id\");\r\n                        if (!id) return null;\r\n                        id = id.replace(\"-list\", \"\");\r\n                        var dd: DropDownListEditComponent = YetaWF.ComponentBaseDataImpl.getControlById(id, DropDownListEditComponent.SELECTOR);\r\n                        let tip = dd.getToolTip(Number(ttindex));\r\n                        if (tip == null || tip.length === 0) return null;\r\n                        return $YetaWF.htmlEscape(tip);\r\n                    }\r\n                    for (; ;) {\r\n                        if (!$this.is(\":hover\") && $this.is(\":focus\"))\r\n                            return null;\r\n                        if ($this.attr(\"disabled\") !== undefined)\r\n                            return null;\r\n                        var s: string | undefined = $this.attr(YConfigs.Basics.CssTooltip);\r\n                        if (s)\r\n                            return $YetaWF.htmlEscape(s);\r\n                        s = $this.attr(YConfigs.Basics.CssTooltipSpan as string);\r\n                        if (s)\r\n                            return $YetaWF.htmlEscape(s);\r\n                        s = $this.attr(\"title\");\r\n                        if (s !== undefined)\r\n                            return $YetaWF.htmlEscape(s);\r\n                        if ($this[0].tagName !== \"IMG\" && $this[0].tagName !== \"I\")\r\n                            break;\r\n                        // we're in an IMG or I tag, find enclosing A (if any) and try again\r\n                        $this = $this.closest(`a:not(\"${YVolatile.Basics.CssNoTooltips}\")`);\r\n                        if ($this.length === 0) return null;\r\n                        // if the a link is a menu, don't show a tooltip for the image because the tooltip would be in a bad location\r\n                        if ($this.closest(\".k-menu\").length > 0) return null;\r\n                    }\r\n                    if ($this[0].tagName === \"A\") {\r\n                        const href = ($this[0] as HTMLAnchorElement).href;\r\n                        if (href === undefined || href.startsWith(\"javascript\") || href.startsWith(\"#\") || href.startsWith(\"mailto:\"))\r\n                            return null;\r\n                        const target = ($this[0] as HTMLAnchorElement).target;\r\n                        if (target === \"_blank\") {\r\n                            const uri = $YetaWF.parseUrl(href);\r\n                            return $YetaWF.htmlEscape(YLocs.Basics.OpenNewWindowTT.format(uri.getHostName()));\r\n                        }\r\n                    }\r\n                    return null;\r\n                },\r\n                position: { my: \"left top\", at: \"right bottom\", collision: \"flipfit\" }\r\n            });\r\n        }\r\n        public static removeTooltips(): void {\r\n            $(\".ui-tooltip\").remove();\r\n        }\r\n    }\r\n}\r\n\r\n$(document).ready(() => {\r\n    YetaWF_ComponentsHTML.Tooltips.init();\r\n});\r\n\r\n$(\"body\").on(\"mousedown\", \"a\", () => {\r\n    // when we click on an <a> link, we don't want the next tooltip\r\n    // this may be a bug because after clicking an a link, the tooltip will be created (again?) so we want to suppress this\r\n    // Repro steps (without hack): right click on an a link (that COULD have a tooltip) and open a new tab/window. On return to this page we'll get a tooltip\r\n    YetaWF_ComponentsHTML.Tooltips.removeTooltips();\r\n});\r\n\r\n"]}