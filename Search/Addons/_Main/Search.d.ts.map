{"version":3,"sources":["Addons/YetaWF/Search/_Main/Search.ts"],"names":[],"mappings":"AAEA,kBAAU,MAAM,CAAC;IACb,UAAiB,SAAS;QACtB,aAAa,EAAE,aAAa,CAAC,iBAAiB,CAAC;KAClD;IACD,UAAiB,QAAQ;QACrB,aAAa,EAAE,aAAa,CAAC,eAAe,CAAC;KAChD;CACJ;AAED,kBAAU,aAAa,CAAC;IAEpB,UAAiB,iBAAiB;QAC9B,SAAS,EAAE,OAAO,CAAC;KACtB;IACD,UAAiB,eAAe;QAC5B,MAAM,EAAE,MAAM,CAAC;KAClB;IAED,MAAa,MAAM;QAEf,OAAc,EAAE,EAAE,OAAO,CAAQ;eAEnB,eAAe,IAAI,IAAI;eAavB,UAAU,IAAI,IAAI;KAmBnC;CAwDJ","file":"Search.d.ts","sourcesContent":["/* Copyright ï¿½ 2019 Softel vdm, Inc. - https://yetawf.com/Documentation/YetaWF/Search#License */\r\n\r\nnamespace YetaWF {\r\n    export interface IVolatile {\r\n        YetaWF_Search: YetaWF_Search.IPackageVolatiles;\r\n    }\r\n    export interface IConfigs {\r\n        YetaWF_Search: YetaWF_Search.IPackageConfigs;\r\n    }\r\n}\r\n\r\nnamespace YetaWF_Search {\r\n\r\n    export interface IPackageVolatiles {\r\n        HighLight: boolean;\r\n    }\r\n    export interface IPackageConfigs {\r\n        UrlArg: string;\r\n    }\r\n\r\n    export class Search {\r\n\r\n        public static on: boolean = true;\r\n\r\n        public static highlightSearch(): void {\r\n            ($(\".yModule\") as any).removeHighlight();\r\n            if (YVolatile.Basics.EditModeActive) return; // never in edit mode\r\n\r\n            var offButton = $YetaWF.getElement1BySelectorCond(\".YetaWF_Search_SearchControl a[data-name='Off']\");\r\n            if (!offButton || offButton.style.display === \"none\") return;\r\n\r\n            var uri = $YetaWF.parseUrl(window.location.href);\r\n            var kwdsString = uri.getSearch(YConfigs.YetaWF_Search.UrlArg);\r\n            if (kwdsString.length === 0) return;\r\n            var kwds = kwdsString.split(\",\");\r\n            ($(\".yPane .yModule\") as any).highlight(kwds);\r\n        }\r\n        public static setButtons(): void {\r\n            var onButton = $YetaWF.getElement1BySelectorCond(\".YetaWF_Search_SearchControl a[data-name='On']\");\r\n            if (!onButton) return;\r\n            var offButton = $YetaWF.getElement1BySelector(\".YetaWF_Search_SearchControl a[data-name='Off']\");\r\n            if (Search.on) {\r\n                if ($YetaWF.parseUrl(window.location.href).hasSearch(YConfigs.YetaWF_Search.UrlArg)) {\r\n                    if (YVolatile.YetaWF_Search && YVolatile.YetaWF_Search.HighLight) {\r\n                        offButton.style.display = \"\";\r\n                        onButton.style.display = \"none\";\r\n                    } else {\r\n                        offButton.style.display = \"none\";\r\n                        onButton.style.display = \"\";\r\n                    }\r\n                    return;\r\n                }\r\n            }\r\n            onButton.style.display = \"none\";\r\n            offButton.style.display = \"none\";\r\n        }\r\n    }\r\n\r\n    // Form postback - highlight new stuff\r\n    if ($YetaWF.FormsAvailable()) {\r\n        $YetaWF.Forms.addPostSubmitHandler(false/*!InPartialView*/, {\r\n            form: null,\r\n            callback: (entry: YetaWF.SubmitHandlerEntry):void => {\r\n                Search.setButtons();\r\n                Search.highlightSearch();\r\n            },\r\n            userdata: null\r\n        });\r\n    }\r\n    // page or page content update - highlight new stuff\r\n    $YetaWF.addWhenReady((tag: HTMLElement): void => {\r\n        Search.setButtons();\r\n        Search.highlightSearch();\r\n    });\r\n    // Handles events turning the addon on/off (used for dynamic content)\r\n    $YetaWF.registerContentChange((addonGuid: string, on: boolean): void => {\r\n        if (addonGuid === \"f7202e79-30bc-43ea-8d7a-12218785207b\") {\r\n            Search.on = on;\r\n        }\r\n    });\r\n\r\n    $YetaWF.registerEventHandlerBody(\"click\", \".YetaWF_Search_SearchControl a[data-name='On']\", (ev: MouseEvent): boolean => {\r\n\r\n        var onButton = $YetaWF.getElement1BySelector(\".YetaWF_Search_SearchControl a[data-name='On']\");\r\n        var offButton = $YetaWF.getElement1BySelector(\".YetaWF_Search_SearchControl a[data-name='Off']\");\r\n        onButton.style.display = \"none\";\r\n        offButton.style.display = \"\";\r\n        Search.highlightSearch();\r\n        YVolatile.YetaWF_Search.HighLight = true;\r\n        $.ajax({\r\n            \"url\": \"/YetaWF_Search/SearchControlModule/Switch\",\r\n            \"type\": \"post\",\r\n            \"data\": `Value=true&${YConfigs.Basics.ModuleGuid}=${encodeURIComponent($YetaWF.getModuleGuidFromTag(onButton))}`\r\n        });\r\n        return false;\r\n    });\r\n    $YetaWF.registerEventHandlerBody(\"click\", \".YetaWF_Search_SearchControl a[data-name='Off']\", (ev: MouseEvent): boolean => {\r\n\r\n        var onButton = $YetaWF.getElement1BySelector(\".YetaWF_Search_SearchControl a[data-name='On']\");\r\n        var offButton = $YetaWF.getElement1BySelector(\".YetaWF_Search_SearchControl a[data-name='Off']\");\r\n        offButton.style.display = \"none\";\r\n        onButton.style.display = \"\";\r\n\r\n        ($(\".yModule\") as any).removeHighlight();\r\n        YVolatile.YetaWF_Search.HighLight = false;\r\n        $.ajax({\r\n            \"url\": \"/YetaWF_Search/SearchControlModule/Switch\",\r\n            \"type\": \"post\",\r\n            \"data\": `Value=false&${YConfigs.Basics.ModuleGuid}=${encodeURIComponent($YetaWF.getModuleGuidFromTag(offButton))}`\r\n        });\r\n        return false;\r\n    });\r\n}"]}