{"version":3,"sources":["AddOns/YetaWF/ImageRepository/_Templates/FlashSelection/FlashSelection.ts"],"names":[],"mappings":"AAEA,kBAAU,sBAAsB,CAAC;IAE7B,MAAa,eAAe;QAExB,OAAO,CAAC,OAAO,CAAiB;QAChC,OAAO,CAAC,MAAM,CAAmB;QACjC,OAAO,CAAC,IAAI,CAAoB;QAChC,OAAO,CAAC,SAAS,CAAiB;QAClC,OAAO,CAAC,WAAW,CAAoB;QACvC,OAAO,CAAC,YAAY,CAAoB;QACxC,OAAO,CAAC,aAAa,CAAoD;oBAEtD,KAAK,EAAE,MAAM;QAiFhC,OAAO,CAAC,UAAU;QAgClB,OAAO,CAAC,aAAa;KAKxB;CACJ","file":"FlashSelection.d.ts","sourcesContent":["/* Copyright Â© 2019 Softel vdm, Inc. - https://yetawf.com/Documentation/YetaWF/ImageRepository#License */\r\n\r\nnamespace YetaWF_ImageRepository {\r\n\r\n    export class FlashRepository {\r\n\r\n        private Control: HTMLDivElement;\r\n        private Hidden: HTMLInputElement;\r\n        private List: HTMLSelectElement;\r\n        private ButtonDiv: HTMLDivElement;\r\n        private ClearButton: HTMLAnchorElement;\r\n        private RemoveButton: HTMLAnchorElement;\r\n        private UploadControl: YetaWF_ComponentsHTML.FileUpload1Component | null;\r\n\r\n        public constructor(divId: string) {\r\n\r\n            this.Control = $YetaWF.getElementById(divId) as HTMLDivElement;\r\n            this.Hidden = $YetaWF.getElement1BySelector(\"input[type='hidden']\", [this.Control]) as HTMLInputElement;\r\n            this.List = $YetaWF.getElement1BySelector(\"select[name='List']\", [this.Control]) as HTMLSelectElement;\r\n            this.ButtonDiv = $YetaWF.getElement1BySelector(\".t_haveflash\", [this.Control]) as HTMLDivElement;\r\n            this.ClearButton = $YetaWF.getElement1BySelector(\"a[data-name='Clear']\", [this.Control]) as HTMLAnchorElement;\r\n            this.RemoveButton = $YetaWF.getElement1BySelector(\"a[data-name='Remove']\", [this.Control]) as HTMLAnchorElement;\r\n\r\n            // show initial selection (if any)\r\n            this.List.value = this.Hidden.value;\r\n            this.setPreview(this.List.value);\r\n\r\n            this.UploadControl = YetaWF.ComponentBaseDataImpl.getControlFromSelectorCond<YetaWF_ComponentsHTML.FileUpload1Component>(\".yt_fileupload1\", YetaWF_ComponentsHTML.FileUpload1Component.SELECTOR, [this.Control]);\r\n            if (this.UploadControl) {\r\n                this.UploadControl.SetSuccessfullUpload((response: YetaWF_ComponentsHTML.FileUploadResponse): void => {\r\n                    this.Hidden.value = response.FileName;\r\n                    this.List.innerHTML = response.List;\r\n                    this.List.value = response.FileName;\r\n                    this.setPreview(response.FileName);\r\n                });\r\n            }\r\n\r\n            // user changed the selected image\r\n            $YetaWF.registerEventHandler(this.List, \"change\", null, (ev: Event): boolean => {\r\n                this.Hidden.value = this.List.value;\r\n                this.setPreview(this.List.value);\r\n                return false;\r\n            });\r\n\r\n            $YetaWF.registerEventHandler(this.ClearButton, \"click\", null, (ev: MouseEvent): boolean => {\r\n                this.clearFileName();\r\n                return false;\r\n            });\r\n            $YetaWF.registerEventHandler(this.RemoveButton, \"click\", null, (ev: MouseEvent): boolean => {\r\n\r\n                // get url to remove the file\r\n\r\n                if ($YetaWF.isLoading) return false;\r\n                $YetaWF.setLoading(true);\r\n\r\n                var uri = $YetaWF.parseUrl(this.RemoveButton.href);\r\n                uri.removeSearch(\"Name\");\r\n                uri.addSearch(\"Name\", this.Hidden.value);\r\n\r\n                var request: XMLHttpRequest = new XMLHttpRequest();\r\n                request.open(\"POST\", uri.toUrl(), true);\r\n                request.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded; charset=UTF-8\");\r\n                request.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n                request.onreadystatechange = (ev: Event): any => {\r\n                    if (request.readyState === 4 /*DONE*/) {\r\n                        $YetaWF.setLoading(false);\r\n                        $YetaWF.processAjaxReturn(request.responseText, request.statusText, request, undefined, undefined, (result: string) => {\r\n\r\n                            $YetaWF.setLoading(false);\r\n\r\n                            if (result.startsWith(YConfigs.Basics.AjaxJavascriptReturn)) {\r\n                                var script = result.substring(YConfigs.Basics.AjaxJavascriptReturn.length);\r\n                                // tslint:disable-next-line:no-eval\r\n                                eval(script);\r\n                                return;\r\n                            } else if (result.startsWith(YConfigs.Basics.AjaxJavascriptErrorReturn)) {\r\n                                var script = result.substring(YConfigs.Basics.AjaxJavascriptErrorReturn.length);\r\n                                // tslint:disable-next-line:no-eval\r\n                                eval(script);\r\n                                return;\r\n                            }\r\n                            var resp: YetaWF_ComponentsHTML.FileUploadRemoveResponse = JSON.parse(result);\r\n                            // tslint:disable-next-line:no-eval\r\n                            eval(resp.Result);\r\n\r\n                            this.List.innerHTML = resp.List;\r\n                            this.clearFileName();\r\n                        });\r\n                    }\r\n                };\r\n                request.send();\r\n                return false;\r\n            });\r\n        }\r\n\r\n        private setPreview(name: string| null): void {\r\n            this.ButtonDiv.style.display = (name && name.length > 0) ? \"\" : \"none\";\r\n\r\n            var param = $YetaWF.getElement1BySelectorCond(\".t_preview param[name='movie']\", [this.Control]) as HTMLParamElement;\r\n            var embed = $YetaWF.getElement1BySelectorCond(\".t_preview embed\", [this.Control]) as HTMLEmbedElement;\r\n            var obj = $YetaWF.getElement1BySelectorCond(\".t_preview object\", [this.Control]) as HTMLObjectElement;\r\n            if (obj) {\r\n                // change object data= (if present)\r\n                if (obj && obj.data) {\r\n                    var currUri = $YetaWF.parseUrl(obj.data);\r\n                    currUri.removeSearch(\"Name\");\r\n                    currUri.addSearch(\"Name\", name);\r\n                    obj.data = currUri.toUrl();\r\n                }\r\n                // change param movie (if present)\r\n                if (param && param.value) {\r\n                    var currUri = $YetaWF.parseUrl(param.value);\r\n                    currUri.removeSearch(\"Name\");\r\n                    currUri.addSearch(\"Name\", name);\r\n                    param.value = currUri.toUrl();\r\n                }\r\n                // change embed (if present)\r\n                if (embed && embed.src) {\r\n                    currUri = $YetaWF.parseUrl(embed.src);\r\n                    currUri.removeSearch(\"Name\");\r\n                    currUri.addSearch(\"Name\", name);\r\n                    embed.src = currUri.toUrl();\r\n                }\r\n                var s = obj.outerHTML;\r\n                obj.outerHTML = s;// replace entire object to make flash recognize the image change\r\n            }\r\n        }\r\n        private clearFileName(): void {\r\n            this.Hidden.value = \"\";\r\n            this.List.value = \"\";\r\n            this.setPreview(null);\r\n        }\r\n    }\r\n}"]}