{"version":3,"sources":["Addons/YetaWF/PageEdit/_Main/PageControl.ts"],"names":[],"mappings":"AAIA,kBAAU,MAAM,CAAC;IACb,UAAiB,QAAQ;QACrB,eAAe,EAAE,eAAe,CAAC,eAAe,CAAC;KACpD;CACJ;AACD,kBAAU,eAAe,CAAC;IACtB,UAAiB,eAAe;QAC5B,cAAc,EAAE,MAAM,CAAC;QACvB,MAAM,EAAE,MAAM,CAAC;KAClB;CACJ;AAED,kBAAU,eAAe,CAAC;CAyGzB","file":"PageControl.d.ts","sourcesContent":["/* Copyright ï¿½ 2019 Softel vdm, Inc. - https://yetawf.com/Documentation/YetaWF/PageEdit#License */\r\n\r\n/* Page Control */\r\n\r\nnamespace YetaWF {\r\n    export interface IConfigs {\r\n        YetaWF_PageEdit: YetaWF_PageEdit.IPackageConfigs;\r\n    }\r\n}\r\nnamespace YetaWF_PageEdit {\r\n    export interface IPackageConfigs {\r\n        PageControlMod: string;\r\n        W3CUrl: string;\r\n    }\r\n}\r\n\r\nnamespace YetaWF_PageEdit {\r\n\r\n    class PageControlModule {\r\n\r\n        private Module: HTMLElement|null = null;\r\n        private readonly FadeTime: number = 250;\r\n\r\n        public init(): void {\r\n\r\n            $YetaWF.addWhenReadyOnce((): void => {\r\n\r\n                this.Module = $YetaWF.getElementByIdCond(YConfigs.YetaWF_PageEdit.PageControlMod);\r\n                if (this.Module) {\r\n\r\n                    // Page icon\r\n                    const pagebutton = $YetaWF.getElementById(\"yPageControlButton\");\r\n\r\n                    $YetaWF.registerEventHandler(pagebutton, \"click\", null, (ev: MouseEvent): boolean => {\r\n                        this.toggleControlPanel();\r\n                        return false;\r\n                    });\r\n                    // on page load, show control panel if wanted\r\n                    if (YVolatile.Basics.PageControlVisible) {\r\n                        this.Module.style.display = \"block\";\r\n                        ComponentsHTMLHelper.processPropertyListVisible(this.Module);\r\n                    }\r\n                }\r\n            });\r\n\r\n            // handle Page Settings, Remove Current Page, W3C Validation - this is needed in case we're in a unified page set\r\n            // in which case the original pageguid and url in the module actions have changed\r\n            // when a new page becomes active, update the module actions reflecting the new page/url\r\n            // also update all hidden fields with the new current page guid\r\n            $YetaWF.addWhenReady((tag: HTMLElement): void => {\r\n\r\n                if ($YetaWF.isInPopup()) {\r\n                    if (YVolatile.Basics.PageControlVisible) {\r\n                        YVolatile.Basics.PageControlVisible = false;\r\n                        this.toggleControlPanel();\r\n                    }\r\n                    return;\r\n                }\r\n\r\n                const pagebutton = $YetaWF.getElementByIdCond(\"yPageControlButton\");\r\n                if (pagebutton) {\r\n                    if (YVolatile.Basics.TemporaryPage) {\r\n                        if (YVolatile.Basics.PageControlVisible) {\r\n                            YVolatile.Basics.PageControlVisible = false;\r\n                            this.toggleControlPanel();\r\n                        }\r\n                        pagebutton.style.display = \"none\";\r\n                    } else {\r\n                        pagebutton.style.display = \"block\";\r\n                    }\r\n                }\r\n\r\n                const ps = $YetaWF.getElement1BySelectorCond(\".YetaWF_PageEdit_PageControl a[data-name='PageSettings']\") as HTMLAnchorElement | null;\r\n                if (ps) {\r\n                    var uri = $YetaWF.parseUrl(ps.href);\r\n                    uri.removeSearch(\"PageGuid\");\r\n                    uri.addSearch(\"PageGuid\", YVolatile.Basics.PageGuid);\r\n                    ps.href = uri.toUrl();\r\n                }\r\n                // Export Page\r\n                const ep = $YetaWF.getElement1BySelectorCond(\".YetaWF_PageEdit_PageControl a[data-name='ExportPage']\") as HTMLAnchorElement | null;\r\n                if (ep) {\r\n                    var uri = $YetaWF.parseUrl(ep.href);\r\n                    uri.removeSearch(\"PageGuid\");\r\n                    uri.addSearch(\"PageGuid\", YVolatile.Basics.PageGuid);\r\n                    ep.href = uri.toUrl();\r\n                }\r\n                // Remove Page\r\n                const rp = $YetaWF.getElement1BySelectorCond(\".YetaWF_PageEdit_PageControl a[data-name='RemovePage']\") as HTMLAnchorElement | null;\r\n                if (rp) {\r\n                    var uri = $YetaWF.parseUrl(rp.href);\r\n                    uri.removeSearch(\"PageGuid\");\r\n                    uri.addSearch(\"PageGuid\", YVolatile.Basics.PageGuid);\r\n                    rp.href = uri.toUrl();\r\n                }\r\n                // W3C validation\r\n                const w3c = $YetaWF.getElement1BySelectorCond(\".YetaWF_PageEdit_PageControl a[data-name='W3CValidate']\") as HTMLAnchorElement | null;\r\n                if (w3c)\r\n                    w3c.href = YConfigs.YetaWF_PageEdit.W3CUrl.format(window.location);\r\n\r\n                const hidden = $YetaWF.getElementsBySelector(\".YetaWF_PageEdit_PageControl input[name='CurrentPageGuid'][type='hidden']\") as HTMLInputElement[];\r\n                for (var h of hidden) {\r\n                    h.value = YVolatile.Basics.PageGuid;\r\n                }\r\n            });\r\n        }\r\n        private toggleControlPanel() :void {\r\n            if (!this.Module) return;\r\n            if ($YetaWF.isVisible(this.Module)) {\r\n                YVolatile.Basics.PageControlVisible = false;\r\n                ComponentsHTMLHelper.fadeOut(this.Module, this.FadeTime);\r\n            } else {\r\n                YVolatile.Basics.PageControlVisible = true;\r\n                ComponentsHTMLHelper.fadeIn(this.Module, this.FadeTime);\r\n            }\r\n        }\r\n    }\r\n\r\n    var pageEdit: PageControlModule = new PageControlModule();\r\n    pageEdit.init();\r\n\r\n}"]}