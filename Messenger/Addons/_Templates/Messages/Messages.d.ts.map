{"version":3,"sources":["AddOns/YetaWF/Messenger/_Templates/Messages/Messages.tsx"],"names":[],"mappings":"AAEA,kBAAU,gBAAgB,CAAC;IAEvB,UAAiB,YAAY;QACzB,OAAO,EAAE,MAAM,CAAC;KACnB;IACD,UAAiB,eAAe;QAC5B,cAAc,EAAE,MAAM,CAAC;KAC1B;IAED,MAAa,gBAAgB;QAEzB,OAAO,CAAC,KAAK,CAAc;QAE3B,OAAO,CAAC,MAAM,CAAc;oBAEhB,KAAK,EAAE,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM;QAI3D;;WAEG;QACH,OAAO,CAAC,IAAI;QAeZ,OAAO,CAAC,aAAa;QAWrB,OAAO,CAAC,iBAAiB;QAUzB,OAAO,CAAC,iBAAiB;QAMzB,OAAO,CAAC,qBAAqB;QAU7B,OAAO,CAAC,mBAAmB;QAK3B,OAAO,CAAC,iBAAiB;KAS5B;CACJ","file":"Messages.d.ts","sourcesContent":["/* Copyright Â© 2018 Softel vdm, Inc. - https://yetawf.com/Documentation/YetaWF/Messenger#License */\r\n\r\nnamespace YetaWF_Messenger {\r\n\r\n    export interface IPackageLocs {\r\n        notSeen: string;\r\n    }\r\n    export interface IPackageConfigs {\r\n        msgNotSeenIcon: string;\r\n    }\r\n\r\n    export class MessagesTemplate {\r\n\r\n        private divId: string = \"\";\r\n        //private fromUser: string = \"\";\r\n        private toUser: string = \"\";\r\n\r\n        constructor(divId: string, fromUser: string, toUser: string) {\r\n            this.init(divId, fromUser, toUser);\r\n        }\r\n\r\n        /**\r\n         * Initializes the module instance.\r\n         */\r\n        private init(divId: string, fromUser: string, toUser: string): void {\r\n\r\n            this.divId = divId;\r\n            //this.fromUser = fromUser;\r\n            this.toUser = toUser;\r\n\r\n            $(document).on(\"YetaWF_Messenger_Messaging_Message\", (event: any, o: any) => this.handleMessage(o.key, o.from, o.messageText, o.sent));\r\n            $(document).on(\"YetaWF_Messenger_Messaging_MessageSent\", (event: any, o: any) => this.handleMessageSent(o.key, o.to, o.messageText, o.sent));\r\n            $(document).on(\"YetaWF_Messenger_Messaging_MessageSeen\", (event: any, o: any) => this.handleMessageSeen(o.key, o.to));\r\n            $(document).on(\"YetaWF_Messenger_Messaging_AllMessagesSeen\", (event: any, o: any) => this.handleAllMessagesSeen(o.to));\r\n\r\n            if (this.toUser && this.toUser.length > 0) {\r\n                YetaWF_Messenger.SkinMessagingModule.singleton.allMessagesSeen(this.toUser);\r\n            }\r\n        }\r\n        private handleMessage(key: number, from: string, messageText: string, sent: string): void {\r\n            if (from === this.toUser) {\r\n                var line: string = `<div class=\"t_otheruser t_seen\" data-key=\"${key}\">` +\r\n                    `<div class=\"t_sent\">${$YetaWF.htmlAttrEscape(sent)}</div>` +\r\n                    `<div class=\"t_text\">${$YetaWF.htmlAttrEscape(messageText)}</div>` +\r\n                    \"</div>\";\r\n                $(`#${this.divId} .t_messagearea .t_last`).before(line);\r\n                this.scrollMessageArea();\r\n                YetaWF_Messenger.SkinMessagingModule.singleton.messageSeen(key);\r\n            }\r\n        }\r\n        private handleMessageSent(key: number, to: string, messageText: string, sent: string): void {\r\n            if (to === this.toUser) {\r\n                var line: string = `<div class=\"t_thisuser t_notseen\" data-key=\"${key}\">` +\r\n                    `<div class=\"t_sent\"><img alt=\"${$YetaWF.htmlAttrEscape(YLocs.YetaWF_Messenger.notSeen)}\" title=\"${$YetaWF.htmlAttrEscape(YLocs.YetaWF_Messenger.notSeen)}\" src=\"${$YetaWF.htmlAttrEscape(YConfigs.YetaWF_Messenger.msgNotSeenIcon)}\">${sent}</div>` +\r\n                    `<div class=\"t_text\">${$YetaWF.htmlAttrEscape(messageText)}</div>` +\r\n                    \"</div>\";\r\n                $(`#${this.divId} .t_messagearea .t_last`).before(line);\r\n                this.scrollMessageArea();\r\n            }\r\n        }\r\n        private handleMessageSeen(key: number, to: string): void {\r\n            if (to === this.toUser) {\r\n                this.markAllMessagesSeen(to);\r\n                //this.markMessageSeen(key, to);\r\n            }\r\n        }\r\n        private handleAllMessagesSeen(to: string): void {\r\n            if (to === this.toUser) {\r\n                this.markAllMessagesSeen(to);\r\n            }\r\n        }\r\n        //private markMessageSeen(key: number, to: string): void {\r\n        //    var $msgArea: JQuery<HTMLElement> = $(`#${this.divId}`);\r\n        //    if ($msgArea.length === 0) throw `Div ${this.divId} not found`;/*DEBUG*/\r\n        //    $(`div.t_notseen[data-key=${key}] img`, $msgArea).remove();\r\n        //}\r\n        private markAllMessagesSeen(to: string): void {\r\n            var $msgArea: JQuery<HTMLElement> = $(`#${this.divId}`);\r\n            if ($msgArea.length === 0) throw `Div ${this.divId} not found`;/*DEBUG*/\r\n            $(`div.t_notseen img`, $msgArea).remove();\r\n        }\r\n        private scrollMessageArea(): void {\r\n            var out: HTMLElement | null = document.getElementById(this.divId);\r\n            if (!out) throw `Div ${this.divId} not found`;/*DEBUG*/\r\n            out.style.display = \"\";\r\n            out.scrollTop = out.scrollHeight - out.clientHeight;\r\n            out = document.getElementById(`${this.divId}_none`);\r\n            if (!out) throw `${this.divId}_none not found`;/*DEBUG*/\r\n            out.style.display = \"none\";\r\n        }\r\n    }\r\n}\r\n"]}